{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/ref.ts", "../src/handler.ts", "../src/reactive.ts", "../src/apiWatch.ts", "../src/computed.ts"],
  "sourcesContent": ["export const isObject = (value) => {\n    return value !== null && typeof value === 'object'\n}\nexport const isFunction = (value) => {\n    return typeof value === 'function'\n}", "export let activeEffect = undefined;\nfunction cleanupEffect(effect) {\n\tlet deps = effect.deps;\n\tfor (let i = 0; i < deps.length; i++) {\n\t\tdeps[i].delete(effect);\n\t}\n\teffect.deps.length = 0; //\u6E05\u7A7A\u4F9D\u8D56\uFF0C\u91CD\u65B0\u6536\u96C6\n}\nexport class ReactiveEffect {\n\tconstructor(private fn, public scheduler) {}\n\tparent = undefined;\n\tdeps = [];\n\tactive = true;\n\trun() {\n\t\tif (!this.active) {\n\t\t\treturn this.fn();\n\t\t}\n\t\ttry {\n\t\t\tthis.parent = activeEffect;\n\t\t\tactiveEffect = this;\n\t\t\t// \u6E05\u7A7A\u4F9D\u8D56\uFF0C\u9632\u6B62\u66F4\u65B0\u7684\u65F6\u5019\uFF0C\u6570\u636E\u6CA1\u6709\u5728\u9875\u9762\u7528\u5230\uFF0C\u4E5F\u4F1A\u6267\u884Ceffect\n\t\t\tcleanupEffect(this);\n\t\t\treturn this.fn();\n\t\t} finally {\n\t\t\tactiveEffect = this.parent;\n\t\t\tthis.parent = undefined;\n\t\t}\n\t}\n\tstop() {\n\t\t//\u505C\u6B62\u4F9D\u8D56\u6536\u96C6\n\t\tthis.active = false;\n\t\tcleanupEffect(this);\n\t}\n}\nexport function effect(fn, option: any = {}) {\n\tconst _effect = new ReactiveEffect(fn, option.scheduler);\n\t_effect.run();\n\tconst runner = _effect.run.bind(_effect);\n\trunner.effect = _effect; // runner.run()\n\treturn runner;\n}\nconst targetMaps = new WeakMap();\n// {{name:'aaa', age: 18},{name,[effect]}}\n// \u4F9D\u8D56\u6536\u96C6\nexport function track(target, key) {\n\tif (activeEffect) {\n\t\tlet depsMap = targetMaps.get(target);\n\t\tif (!depsMap) {\n\t\t\ttargetMaps.set(target, (depsMap = new Map()));\n\t\t}\n\t\tlet dep = depsMap.get(key);\n\t\tif (!dep) {\n\t\t\tdepsMap.set(key, (dep = new Set()));\n\t\t}\n\t\ttrackEffect(dep);\n\t}\n}\nexport function trackEffect(dep) {\n\tlet shouldTrack = !dep.has(activeEffect);\n\tif (shouldTrack) {\n\t\tdep.add(activeEffect);\n\t\tactiveEffect.deps.push(dep);\n\t}\n}\nexport function triggerEffects(dep) {\n\tlet effects = [...dep];\n\teffects &&\n\t\teffects.forEach((effect) => {\n\t\t\tif (effect !== activeEffect) {\n\t\t\t\tif (effect.scheduler) {\n\t\t\t\t\t// \u7528\u6237\u4F20\u9012scheduler\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u81EA\u5DF1\u63A7\u5236\u6267\u884C\u66F4\u65B0\u64CD\u4F5C\uFF08\u5F02\u6B65\u66F4\u65B0\uFF09\n\t\t\t\t\teffect.scheduler();\n\t\t\t\t} else {\n\t\t\t\t\teffect.run();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n}\nexport function trigger(target, key, value, oldValue) {\n\tconst depsMap = targetMaps.get(target);\n\tif (!depsMap) return;\n\tlet dep = depsMap.get(key);\n\ttriggerEffects(dep);\n}\n", "import { isObject } from '@vue/shared';\nimport { reactive } from './reactive';\nimport { trackEffect, triggerEffects } from './effect';\n\nexport function isRef(value) {\n\treturn !!(value && value.__v_isRef);\n}\n\nexport function toReactive(value) {\n\treturn isObject(value) ? reactive(value) : value;\n}\n\nclass RefImpl {\n\tpublic _value;\n\tpublic __v_isRef = true;\n\tpublic dep = new Set();\n\tconstructor(public rawValue) {\n\t\tthis._value = toReactive(rawValue);\n\t}\n\tget value() {\n\t\ttrackEffect(this.dep);\n\t\treturn this._value;\n\t}\n\tset value(newValue) {\n\t\tif (newValue !== this.rawValue) {\n\t\t\tthis.rawValue = newValue;\n\t\t\tthis._value = toReactive(newValue);\n\t\t\ttriggerEffects(this.dep);\n\t\t}\n\t}\n}\nexport function ref(value) {\n    debugger\n\treturn new RefImpl(value);\n}\n", "import { ReactiveFlags, reactive } from './reactive';\nimport { activeEffect, track, trigger } from './effect';\nimport { isRef } from './ref';\nimport { isObject } from '../../shared/src/index';\n//\u4F7F\u7528Reflect\u662F\u4E3A\u4E86\u89E3\u51B3this\u6307\u5411\u95EE\u9898\nexport const mutableHandlers = {\n\tget(target, key, receiver) {\n\t\t// \u4E3A\u4E86\u89E3\u51B3\u5BF9\u8C61\u662F\u5426\u88AB\u4EE3\u7406\uFF0C\u88AB\u4EE3\u7406\u7684\u76F4\u63A5\u88AB\u8FD4\u56DE\uFF0C\u4E0D\u8BA9\u91CD\u590D\u4EE3\u7406\n\t\tif (key === ReactiveFlags.IS_REACTIVE) {\n\t\t\treturn true;\n\t\t}\n\t\tif (isRef(target[key])) {\n\t\t\treturn target[key].value;\n\t\t}\n\t\t// \u6DF1\u5C42\u4EE3\u7406\n\t\tif (isObject(target[key])) {\n\t\t\treturn reactive(target[key]);\n\t\t}\n\t\tconst res = Reflect.get(target, key, receiver);\n\t\t// \u6536\u96C6\u4F9D\u8D56,\u8BA9effect\u548C\u5C5E\u6027\u4F9D\u8D56\u53CC\u5411\u8BB0\u5FC6\n\t\ttrack(target, key);\n\t\treturn res;\n\t},\n\tset(target, key, value, receiver) {\n\t\tconst oldValue = target[key];\n\t\tconst res = Reflect.set(target, key, value, receiver);\n\t\tif (value !== oldValue) {\n\t\t\t// \u89E6\u53D1\u66F4\u65B0\n\t\t\ttrigger(target, key, value, oldValue);\n\t\t}\n\t\treturn res;\n\t},\n};\n", "import { mutableHandlers } from './handler';\nimport { isObject } from '@vue/shared';\n\nconst reactiveMap = new WeakMap();\n\nexport const enum ReactiveFlags {\n\tIS_REACTIVE = '__v_isReactive',\n}\nexport function reactive(target) {\n\tif (!isObject(target)) return target;\n\n\tlet existingProxy = reactiveMap.get(target); // \u89E3\u51B3\u91CD\u590D\u4EE3\u7406\u95EE\u9898\n\tif (existingProxy) return existingProxy;\n\tif (target[ReactiveFlags.IS_REACTIVE]) return target; // \u89E3\u51B3\u91CD\u590D\u4EE3\u7406\u95EE\u9898\n\tconst proxy = new Proxy(target, mutableHandlers);\n\treactiveMap.set(target, proxy);\n\treturn proxy;\n}\n\nexport function isReactive(value) {\n\tif(value[ReactiveFlags.IS_REACTIVE]) return true;\n}", "import { isObject, isFunction } from '@vue/shared';\nimport { isReactive } from './reactive';\nimport { ReactiveEffect } from './effect';\nfunction traverse(value, seen = new Set()) {\n\tif (!isObject(value)) return value;\n\tif (seen.has(value)) return value;\n\tseen.add(value);\n\tfor (const key in value) {\n\t\ttraverse(value[key], seen);\n\t}\n\treturn value;\n}\n\nexport function watch(source, cb, options) {\n\t// effect+scheduler\n\treturn dowatch(source, cb, options);\n}\nexport function watchEffect(source, options) {\n\t// effect\n\treturn dowatch(source, null, options);\n}\n\nexport function dowatch(source, cb, options) {\n\t// effect + scheduler\n\t// souece: \u4F20\u5165\u7684\u6570\u636E \u54CD\u5E94\u5F0F\u6570\u636E\uFF08\u5BF9\u8C61\u3001\u51FD\u6570\uFF09\n\tlet getter;\n\tif (isReactive(source)) {\n\t\tgetter = () => traverse(source);\n\t} else if (isFunction(source)) {\n\t\tgetter = source;\n\t}\n\tlet oldValue;\n\tlet clear;\n\tlet onClearup = (fn) => { //\u6E05\u7406\u4E0A\u4E00\u6B21\u64CD\u4F5C\n\t\tclear = fn;\n\t};\n\tconst job = () => {\n\t\tif (cb) {\n            if(clear) clear()\n\t\t\tconst newValue = effect.run();\n\t\t\tcb(newValue, oldValue, onClearup);\n\t\t\toldValue = newValue;\n\t\t} else {\n\t\t\teffect.run();\n\t\t}\n\t};\n\tconst effect = new ReactiveEffect(getter, job);\n\toldValue = effect.run();\n}\n", "import {\n\tactiveEffect,\n\tReactiveEffect,\n\ttrackEffect,\n\ttriggerEffects,\n} from './effect';\nimport { isFunction } from '../../shared/src/index';\nclass CompoutedRefImpl {\n\tpublic effect;\n\tpublic _value;\n\tpublic _dirty = true;\n\tpublic dep = new Set();\n    public _v_isRef = true //\u53EF\u4EE5\u589E\u52A0\u62C6\u5305\u903B\u8F91\uFF08\u4F7F\u7528\u8BA1\u7B97\u5C5E\u6027\u548Cref\u53EF\u4E0D\u4E0D\u52A0.value\uFF09\n\tconstructor(getter, public setter) {\n\t\tthis.effect = new ReactiveEffect(getter, () => {\n\t\t\tif (!this._dirty) {\n\t\t\t\tthis._dirty = true;\n\t\t\t\ttriggerEffects(this.dep);\n\t\t\t}\n\t\t});\n\t}\n\tget value() {\n\t\ttrackEffect(this.dep);\n\t\tif (this._dirty) {\n\t\t\tthis._dirty = false;\n\t\t\tthis._value = this.effect.run();\n\t\t}\n\t\treturn this._value;\n\t}\n\tset value(newVal) {\n\t\tthis.setter(newVal);\n\t}\n}\nexport function computed(getterOrOptions) {\n\tlet getter, setter;\n\tconst isGetter = isFunction(getterOrOptions);\n\tif (isGetter) {\n\t\tgetter = getterOrOptions;\n\t\tsetter = () => {\n\t\t\tconsole.log('warning');\n\t\t};\n\t} else {\n\t\tgetter = getterOrOptions.get;\n\t\tsetter = getterOrOptions.set;\n\t}\n\treturn new CompoutedRefImpl(getter, setter);\n}\n"],
  "mappings": "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",
  "names": ["effect", "effect"]
}
